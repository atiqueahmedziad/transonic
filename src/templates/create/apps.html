{# This template is used for both creating and editing a featured app. #}

<form class="transonic-form apps {{ 'edit' if obj else 'create' }}" data-type="apps"
      {% if obj %}data-slug="{{ obj.slug }}"{% endif %}>
  {# Short abbreviations. #}
  {% set FT_ICON = settings.FEEDAPP_TYPE_ICON %}
  {% set FT_IMAGE = settings.FEEDAPP_TYPE_IMAGE%}
  {% set FT_DESC = settings.FEEDAPP_TYPE_DESC %}
  {% set FT_QUOTE = settings.FEEDAPP_TYPE_QUOTE %}
  {% set FT_PREVIEW = settings.FEEDAPP_TYPE_PREVIEW %}

  {% set feed_app_type = obj.feedapp_type if obj else FT_ICON %}

  <section class="island">
    {% include "locale_switcher.html" %}

    <h3>{{ title }}</h3>

    {% include "app_selector.html" %}
    {% include "apps_widget.html" %}

    {% include "fields/slug.html" %}
  </section>

  {% macro featured_type(name, type, val, obj_val) %}
    {# Tabs for the type of featured app. #}
    <input id="featured-type-{{ type }}" type="radio"
           name="featured-type" value="{{ val }}"
           data-type="{{ type }}"
           {% if obj_val == val %} checked{%endif%} />
    <label for="featured-type-{{ type }}">{{ name }}</label>
  {% endmacro %}

  <fieldset class="featured-type-choices tabs">
    {{ featured_type(_('Icon'), 'icon', FT_ICON, feed_app_type) }}
    {{ featured_type(_('Header Graphic'), 'background-image', FT_IMAGE, feed_app_type) }}
    {{ featured_type(_('Description'), 'description', FT_DESC, feed_app_type) }}
    {{ featured_type(_('Quote'), 'quote', FT_QUOTE, feed_app_type) }}
    {{ featured_type(_('Screenshot'), 'screenshot', FT_PREVIEW, feed_app_type) }}
  </fieldset>

  <section class="island customize">
    <h3>{{ _('Customize') }}</h3>

    {# The top line of classes determine what form fields are visible based upon the tab on change. #}
    {# The bottom line of classes determine what form fields are visible if we are editing an app and go directly to the page. #}
    <div class="featured-details icon background-image quote screenshot
                {{ 'hidden' if indexOf([FT_ICON, FT_IMAGE, FT_QUOTE, FT_PREVIEW], feed_app_type) == -1 }}">
      {% include "fields/colors.html" %}
    </div>

    <div class="featured-details background-image
                {{ 'hidden' if indexOf([FT_IMAGE], feed_app_type) == -1 }}">
      {% include "fields/background_images.html" %}
    </div>

    <div class="featured-details description screenshot
                {{ 'hidden' if indexOf([FT_DESC, FT_PREVIEW], feed_app_type) == -1 }}">
      {% include "fields/description.html" %}
    </div>

    <div class="featured-details quote
                {{ 'hidden' if indexOf([FT_QUOTE], feed_app_type) == -1 }}">
      {% include "fields/quote.html" %}
    </div>

    <div class="featured-details screenshot
                {{ 'hidden' if indexOf([FT_PREVIEW], feed_app_type) == -1 }}">
      {% include "fields/screenshot.html" %}
    </div>
  </section>

  <section class="island submit">
    <h3>
      {% if obj %}
        {{ _('Update Featured App') }}
      {% else %}
        {{ _('Submit Featured App') }}
      {% endif %}
    </h3>
    <div class="form-errors"></div>
    <button class="submit">
      {% if obj %}
        {{ _('Update') }}
      {% else %}
        {{ _('Submit') }}
      {% endif %}
    </button>
  </section>
</form>
